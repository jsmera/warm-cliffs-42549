{% extends "base.html" %}
{% load crispy_forms_tags %}
{% load static %}
{% block title %}Crear nuevo usuario{% endblock %}
{% block nav_title %}Crear nuevo usuario{% endblock %}

{% block content %}
    <div class="row">
      <div class="col-md-4">
        <div class="card card-user">
          <div class="image">
            <img id="nutri" src="{% static 'img/consultorio.jpg' %}" alt="...">
            <img id="admin" style="display: none;" src="{% static 'img/admin.jpg' %}" alt="...">
          </div>
          <div class="card-body">
            <div class="author">
              <a href="#">
                <img class="avatar border-gray" src="{% static 'img/mike.jpg' %}" alt="...">
                <h5 class="title"><span id="show_first_name">Nombre</span> <span id="show_last_name"></span></h5>
              </a>
              <p id="show_username" class="description">
                @usuario
              </p>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-8">
        <div class="card card-user">
          <div class="card-header">
            <h5 class="card-title">Perfil</h5>
          </div>
          <div class="card-body">
            <form method="post">
              {% csrf_token %}
              <div class="row">
                <div class="col-md-6 pr-1">
                  <div class="form-group">
                    {{ form.username|as_crispy_field }}
                  </div>
                </div>
                <div class="col-md-6 pl-1">
                  <div class="form-group">
                    {{ form.email|as_crispy_field }}
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 pr-1">
                  <div class="form-group">
                    {{ form.first_name|as_crispy_field }}
                  </div>
                </div>
                <div class="col-md-6 pl-1">
                  <div class="form-group">
                    {{ form.last_name|as_crispy_field }}
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-4 pr-1">
                  <div class="form-group">
                    {{ form.estado_civil|as_crispy_field }}
                  </div>
                </div>
                <div class="col-md-4 px-1">
                  <div class="form-group">
                    {{ form.tipo_documento|as_crispy_field }}
                  </div>
                </div>
                <div class="col-md-4 pl-1">
                  <div class="form-group">
                    {{ form.num_documento|as_crispy_field }}
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-4 pr-1">
                  <div class="form-group">
                    {{ form.direccion|as_crispy_field }}
                  </div>
                </div>
                <div class="col-md-4 px-1">
                  <div class="form-group">
                    {{ form.telefono|as_crispy_field }}
                  </div>
                </div>
                <div class="col-md-4 pl-1">
                  <div class="form-group">
                    {{ form.fecha_nacimiento|as_crispy_field }}
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-4 pr -1">
                  <div class="form-group">
                    {{ form.password1|as_crispy_field }}
                  </div>
                </div>
                <div class="col-md-4 px-1">
                  <div class="form-group">
                    {{ form.password2|as_crispy_field }}
                  </div>
                </div>
                <div class="col-md-4 pl-1">
                  <div class="form-group">
                    {{ form.rol|as_crispy_field }}
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="update ml-auto mr-auto">
                  <button type="submit" class="btn btn-primary btn-round">Guardar</button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
{% endblock %}

{% block extra_js %}
    <script>
      const capitalize = (s) => {
        if (typeof s !== 'string') return '';
        return s.charAt(0).toUpperCase() + s.slice(1).toLowerCase();
      }
      const roles = ["nutri", "admin"];
      $('#id_fecha_nacimiento').datepicker({
        format: "yyyy-mm-dd",
        language: "es",
        orientation: "bottom auto"
      });
      $(document).ready(function() {
        $("#id_first_name").keyup(function() {
          let nombre = $(this).val();
          let nombres = nombre.split(" ");
          nombres = nombres.map(capitalize);
          full_name = nombres.join(" ");
          $(this).val(full_name);
          if (full_name != "") {
            $("#show_first_name").text(full_name);
          } else {
            $("#show_first_name").text("Nombre");
          }
        });
        $("#id_last_name").keyup(function() {
          let nombre = $(this).val();
          let nombres = nombre.split(" ");
          nombres = nombres.map(capitalize);
          full_name = nombres.join(" ");
          $(this).val(full_name);
          if (full_name != "") {
            $("#show_last_name").text(full_name);
          } else {
            $("#show_last_name").text("");
          }
        });
        $("#id_username").keyup(function() {
          let username = $(this).val();
          if (username != "") {
            $("#show_username").text("@"+username);
          } else {
            $("#show_username").text("@usuario");
          }
        });
        $("#id_rol").change(function() {
          let rol = $(this).val();
          for (i in roles) {
            if (roles[i] != rol) {
              $("#"+roles[i]).css("display", "none");
            } else{
              $("#"+roles[i]).css("display", "initial");
            }
          }
        });
      })
    </script>
{% endblock %}

